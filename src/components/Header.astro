---
import LanguageSwitcher from './LanguageSwitcher.astro';
import { useTranslations } from '../i18n/utils';
import type { Lang } from '../i18n/utils';

interface Props {
  lang: Lang;
  compact?: boolean;
}

const { lang, compact = false } = Astro.props;
const t = useTranslations(lang);
const basePath = `/${lang}`;
---

<header id="main-header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-500 bg-white/90 backdrop-blur-lg border-b border-slate-200/60">
  <nav class={`max-w-7xl mx-auto px-6 md:px-8 flex items-center justify-between ${compact ? 'h-[72px] md:h-[80px]' : 'h-[140px] md:h-[160px]'}`}>
    <!-- Logo -->
    <a href={`${basePath}/`} class="flex items-center gap-3 group flex-shrink-0">
      <img
        src="/logo-aion-dark.png"
        alt="AION Growth Studio"
        class={`w-auto transition-transform duration-500 group-hover:scale-105 ${compact ? 'h-[48px] md:h-[56px]' : 'h-[108px] md:h-[132px]'}`}
        loading="eager"
      />
    </a>

    <!-- Right side: Nav + Language -->
    <div class="hidden lg:flex items-center gap-1">
      <a href={`${basePath}/#soluciones`} class="nav-link">{t('nav.soluciones')}</a>
      <a href={`${basePath}/#casos`} class="nav-link">{t('nav.casos')}</a>
      <a href={lang === 'es' ? '/es/diagnostico' : '/en/diagnostic'} class="nav-link">{t('nav.diagnostico')}</a>
      <a href={`/${lang === 'es' ? '' : 'en/'}blog`} class="nav-link">{t('nav.blog')}</a>
      <a href={`${basePath}/#contacto`} class="nav-link">{t('nav.contacto')}</a>

      <div class="w-px h-4 bg-slate-300 mx-3"></div>

      <LanguageSwitcher lang={lang} />
    </div>

    <!-- Mobile menu button -->
    <button
      id="mobile-menu-btn"
      class="lg:hidden p-2 -mr-2 rounded-xl hover:bg-slate-100 transition-colors"
      aria-label="Open menu"
      aria-expanded="false"
    >
      <svg id="menu-icon-open" class="w-6 h-6 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
      <svg id="menu-icon-close" class="w-6 h-6 text-slate-700 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </nav>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="lg:hidden hidden">
    <div class="px-6 py-6 bg-white border-t border-slate-100">
      <div class="flex flex-col gap-1">
        <a href={`${basePath}/#soluciones`} class="mobile-nav-link">{t('nav.soluciones')}</a>
        <a href={`${basePath}/#casos`} class="mobile-nav-link">{t('nav.casos')}</a>
        <a href={lang === 'es' ? '/es/diagnostico' : '/en/diagnostic'} class="mobile-nav-link">{t('nav.diagnostico')}</a>
        <a href={`/${lang === 'es' ? '' : 'en/'}blog`} class="mobile-nav-link">{t('nav.blog')}</a>
        <a href={`${basePath}/#contacto`} class="mobile-nav-link">{t('nav.contacto')}</a>
      </div>
      <div class="mt-4 pt-4 border-t border-slate-100">
        <LanguageSwitcher lang={lang} />
      </div>
    </div>
  </div>
</header>

<div class={compact ? 'h-[72px] md:h-[80px]' : 'h-[140px] md:h-[160px]'}></div>

<style>
  .nav-link {
    padding: 0.375rem 0.875rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: rgb(71 85 105);
    border-radius: 0.5rem;
    transition: color 0.2s ease, background 0.2s ease;
  }

  .nav-link:hover {
    color: rgb(15 23 42);
    background: rgb(241 245 249);
  }

  .mobile-nav-link {
    display: block;
    padding: 0.75rem 1rem;
    font-size: 1rem;
    font-weight: 500;
    color: rgb(71 85 105);
    border-radius: 0.75rem;
    transition: all 0.2s ease;
  }

  .mobile-nav-link:hover {
    color: rgb(15 23 42);
    background: rgb(248 250 252);
  }
</style>

<script>
  const header = document.getElementById('main-header');
  if (header) {
    window.addEventListener('scroll', () => {
      header.classList.toggle('shadow-sm', window.scrollY > 10);
    });
  }

  const menuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const iconOpen = document.getElementById('menu-icon-open');
  const iconClose = document.getElementById('menu-icon-close');

  if (menuBtn && mobileMenu && iconOpen && iconClose) {
    menuBtn.addEventListener('click', () => {
      const isOpen = !mobileMenu.classList.contains('hidden');
      mobileMenu.classList.toggle('hidden');
      iconOpen.classList.toggle('hidden');
      iconClose.classList.toggle('hidden');
      menuBtn.setAttribute('aria-expanded', String(!isOpen));
    });

    mobileMenu.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', () => {
        mobileMenu.classList.add('hidden');
        iconOpen.classList.remove('hidden');
        iconClose.classList.add('hidden');
        menuBtn.setAttribute('aria-expanded', 'false');
      });
    });
  }
</script>
